<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DEMO - Cache Co-locality for Workload Scheduling | Fluid</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/vuepresswebsite/fluid-stacked-color.svg">
    <meta name="description" content="Fluid, elastic data abstraction and acceleration for BigData/AI applications in cloud.">
    
    <link rel="preload" href="/vuepresswebsite/assets/css/0.styles.1e2b0eee.css" as="style"><link rel="preload" href="/vuepresswebsite/assets/js/app.62980e8d.js" as="script"><link rel="preload" href="/vuepresswebsite/assets/js/2.9a6ad13a.js" as="script"><link rel="preload" href="/vuepresswebsite/assets/js/38.55aca518.js" as="script"><link rel="prefetch" href="/vuepresswebsite/assets/js/10.dd472adc.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/11.19c26ce4.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/12.41075cef.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/13.e715ec2c.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/14.886d72d3.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/15.b6a2be84.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/16.4dcedb7d.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/17.f95b6c7e.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/18.af2dc32f.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/19.34c0dd6a.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/20.a4e6b7ab.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/21.9b46bb25.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/22.643ca307.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/23.79764695.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/24.112d9587.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/25.d1d6c632.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/26.762e9252.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/27.1b0c0345.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/28.0d96ba8d.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/29.d227017f.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/3.b887a95d.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/30.b886c854.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/31.107d4f72.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/32.b27e572d.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/33.43ef3449.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/34.4fe6c9b6.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/35.a15bfcef.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/36.b23781fe.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/37.9d5e141f.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/39.5e960c44.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/4.fccdcfbd.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/40.50864941.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/41.494a04d1.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/42.b99d7305.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/43.fea205eb.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/44.9088e230.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/45.a94b2a9d.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/46.26a8e862.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/47.18cbe250.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/48.ba13dd49.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/49.99d1e0c5.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/5.ec1ee913.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/50.a454b1d9.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/51.121f157b.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/52.adec05ae.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/53.1a0fbd40.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/54.335d85c6.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/55.9cab70b1.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/56.546242ca.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/57.78332555.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/58.9e25a51a.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/59.3441c002.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/6.aa3c3257.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/60.43585e16.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/61.abdfa916.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/62.64f9138b.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/63.a1059ea6.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/64.3f19fef4.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/65.ab097974.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/66.80e6542a.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/67.64dd5459.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/68.c6729130.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/69.c4a06b06.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/7.db6ed301.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/70.2f7b8ef9.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/71.80d026f1.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/72.2b04e9ae.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/73.09e7b840.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/74.826dc400.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/75.092b7183.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/76.678b08b3.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/77.60202d0d.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/78.6be2ca13.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/79.dfd5e9a3.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/8.58db8978.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/80.5a7939e2.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/81.d1c5ea9e.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/82.03ad3105.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/83.8b4538fe.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/84.bdf345d6.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/85.c97702e3.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/86.88711427.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/87.4855b59a.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/88.0296f468.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/89.32efc65b.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/9.71e690e0.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/90.dbb9a9be.js"><link rel="prefetch" href="/vuepresswebsite/assets/js/91.3740289e.js">
    <link rel="stylesheet" href="/vuepresswebsite/assets/css/0.styles.1e2b0eee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepresswebsite/" class="home-link router-link-active"><img src="/vuepresswebsite/fluid-horizontal-color.png" alt="Fluid" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docs" class="dropdown-title"><span class="title">Docs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Docs" class="mobile-dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepresswebsite/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/dev/" class="nav-link">
  Dev
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/samples/" class="nav-link router-link-active">
  Samples
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepresswebsite/community/community.html" class="nav-link">
  Community
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/community/ADOPTERS.html" class="nav-link">
  Adopters
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepresswebsite/blog/technology/" class="nav-link">
  Technology
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/blog/releases/" class="nav-link">
  Releases
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/blog/casestudy/" class="nav-link">
  Case Study
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepresswebsite/samples/data_co_locality.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/zh/samples/data_co_locality.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docs" class="dropdown-title"><span class="title">Docs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Docs" class="mobile-dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepresswebsite/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/dev/" class="nav-link">
  Dev
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/samples/" class="nav-link router-link-active">
  Samples
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepresswebsite/community/community.html" class="nav-link">
  Community
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/community/ADOPTERS.html" class="nav-link">
  Adopters
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepresswebsite/blog/technology/" class="nav-link">
  Technology
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/blog/releases/" class="nav-link">
  Releases
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/blog/casestudy/" class="nav-link">
  Case Study
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepresswebsite/samples/data_co_locality.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/vuepresswebsite/zh/samples/data_co_locality.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/vuepresswebsite/samples/" aria-current="page" class="sidebar-link">DEMO - Speed Up Accessing Remote Files</a></li><li><a href="/vuepresswebsite/samples/accelerate_pvc.html" class="sidebar-link">DEMO - Accelerate PVC with Fluid</a></li><li><a href="/vuepresswebsite/samples/machinelearning.html" class="sidebar-link">DEMO - Accelerate Machine Learning Training with Fluid</a></li><li><a href="/vuepresswebsite/samples/data_warmup.html" class="sidebar-link">Demo - Data Preloading</a></li><li><a href="/vuepresswebsite/samples/accelerate_hdfs.html" class="sidebar-link">DEMO - Speed Up Accessing HDFS Client Files</a></li><li><a href="/vuepresswebsite/samples/accelerate_s3_minio.html" class="sidebar-link">DEMO - Speed Up Accessing Minio Files</a></li><li><a href="/vuepresswebsite/samples/data_co_locality.html" aria-current="page" class="active sidebar-link">DEMO - Cache Co-locality for Workload Scheduling</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepresswebsite/samples/data_co_locality.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/vuepresswebsite/samples/data_co_locality.html#set-up-workspace" class="sidebar-link">Set Up Workspace</a></li><li class="sidebar-sub-header"><a href="/vuepresswebsite/samples/data_co_locality.html#install-resources-to-kubernetes" class="sidebar-link">Install Resources to Kubernetes</a></li><li class="sidebar-sub-header"><a href="/vuepresswebsite/samples/data_co_locality.html#clean-up" class="sidebar-link">Clean Up</a></li></ul></li><li><a href="/vuepresswebsite/samples/multi_dataset_same_node_accessing.html" class="sidebar-link">DEMO - Single-Machine Multiple-Dataset Speed Up Accessing Remote Files</a></li><li><a href="/vuepresswebsite/samples/nonroot_access.html" class="sidebar-link">Example - Using Fluid to access non-root user's data</a></li><li><a href="/vuepresswebsite/samples/tieredstore_config.html" class="sidebar-link">Demo - Alluxio Tieredstore Configuration</a></li><li><a href="/vuepresswebsite/samples/use_encryptoptions.html" class="sidebar-link">DEMO - Use Secret to configure Dataset sensitive information</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="demo-cache-co-locality-for-workload-scheduling"><a href="#demo-cache-co-locality-for-workload-scheduling" class="header-anchor">#</a> DEMO - Cache Co-locality for Workload Scheduling</h1> <p>In Fluid, remote files specified in <code>Dataset</code> object are schedulable, which means you are able to control where to put your data in a k8s cluster,
just like what you may have done to Pods. Also, Fluid is able to make cache co-locality scheduling decisions for workloads to minimize overhead costs.</p> <p>This demo will show you an overview about features mentioned above.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>Before everything we are going to do, please refer to <a href="/vuepresswebsite/userguide/install.html">Installation Guide</a> to install Fluid on your Kubernetes Cluster, and make sure all the components used by Fluid are ready like this:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pod -n fluid-system
NAME                                  READY   STATUS    RESTARTS   AGE
alluxioruntime-controller-5b64fdbbb-84pc6   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8h
csi-nodeplugin-fluid-fwgjh                  <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8h
csi-nodeplugin-fluid-ll8bq                  <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8h
dataset-controller-5b7848dbbb-n44dj         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8h
</code></pre></div><p>Normally, you shall see a Pod named &quot;dataset-controller&quot;, a Pod named &quot;alluxioruntime-controller&quot; and several Pods named &quot;csi-nodeplugin&quot;.
The num of &quot;csi-nodeplugin&quot; Pods depends on how many nodes your Kubernetes cluster have(e.g. 2 in this demo), so please make sure all &quot;csi-nodeplugin&quot; Pods are working properly.</p> <h2 id="set-up-workspace"><a href="#set-up-workspace" class="header-anchor">#</a> Set Up Workspace</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">mkdir</span> <span class="token operator">&lt;</span>any-path<span class="token operator">&gt;</span>/co-locality
$ <span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>any-path<span class="token operator">&gt;</span>/co-locality
</code></pre></div><h2 id="install-resources-to-kubernetes"><a href="#install-resources-to-kubernetes" class="header-anchor">#</a> Install Resources to Kubernetes</h2> <p><strong>Check all nodes in your Kubernetes cluster</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get nodes
NAME                       STATUS   ROLES    AGE     VERSION
cn-beijing.192.168.1.146   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   7d14h   v1.16.9-aliyun.1
cn-beijing.192.168.1.147   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   7d14h   v1.16.9-aliyun.1
</code></pre></div><p><strong>Label one of the nodes</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl label nodes cn-beijing.192.168.1.146 hbase-cache<span class="token operator">=</span>true
</code></pre></div><p>Since we'll use <code>NodeSelector</code> to manage where to put our data, we mark the desired node by labeling it.</p> <p><strong>Check all nodes again</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get node -L hbase-cache
NAME                       STATUS   ROLES    AGE     VERSION            HBASE-CACHE
cn-beijing.192.168.1.146   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   7d14h   v1.16.9-aliyun.1   <span class="token boolean">true</span>
cn-beijing.192.168.1.147   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   7d14h   v1.16.9-aliyun.1   
</code></pre></div><p>Only one of the two nodes holds a label <code>hbase-cache=true</code>. In the following steps, we are going to make sure it's the only location the data cache can be put on.</p> <p><strong>Check the <code>Dataset</code> object to be created</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ cat<span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>dataset.yaml</span>
apiVersion: data.fluid.io/v1alpha1
kind: Dataset
metadata:
  name: hbase
spec:
  mounts:
    - mountPoint: https://downloads.apache.org/hbase/stable/
      name: hbase
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: hbase-cache
              operator: In
              values:
                - &quot;true&quot;
EOF</span>
</code></pre></div><p>We defined a <code>nodeSelectorTerm</code> in <code>Dataset</code> object's <code>spec</code> to make sure only nodes with label <code>hbase-cache=true</code> are considered to be available for the dataset.</p> <p><strong>Create the dataset object</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl create -f dataset.yaml
dataset.data.fluid.io/hbase created
</code></pre></div><p><strong>Check the <code>AlluxioRuntime</code> object to be created</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ cat<span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>runtime.yaml</span>
apiVersion: data.fluid.io/v1alpha1
kind: AlluxioRuntime
metadata:
  name: hbase
spec:
  replicas: 2
  tieredstore:
    levels:
      - mediumtype: MEM
        path: /dev/shm
        quota: 2Gi
        high: &quot;0.95&quot;
        low: &quot;0.7&quot;
EOF</span>
</code></pre></div><p>In this snippet of yaml, there are many specifications used by Fluid to launch an Alluxio instance. The <code>spec.replicas</code> in the yaml above is set to 2, which means an Alluxio instance with 1 master and 2 workers is expected to be launched.</p> <p><strong>Create the <code>AlluxioRuntime</code> object</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl create -f runtime.yaml
alluxioruntime.data.fluid.io/hbase created

$ kubectl get pod -o wide
NAME                 READY   STATUS    RESTARTS   AGE    IP              NODE                       NOMINATED NODE   READINESS GATES
hbase-fuse-42csf     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          104s   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-master-0       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          3m3s   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-worker-l62m4   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          104s   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>While two running workers are expected, there's only one running on the node with label <code>hbase-cache=true</code>. The <code>nodeSelectorTerm</code> stops another worker from being deployed.</p> <p><strong>Check status of the <code>AlluxioRuntime</code> object</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get alluxioruntime hbase -o wide
NAME    READY MASTERS   DESIRED MASTERS   MASTER PHASE   READY WORKERS   DESIRED WORKERS   WORKER PHASE   READY FUSES   DESIRED FUSES   FUSE PHASE     AGE
hbase   <span class="token number">1</span>               <span class="token number">1</span>                 Ready          <span class="token number">1</span>               <span class="token number">2</span>                 PartialReady   <span class="token number">1</span>             <span class="token number">2</span>               PartialReady   4m3s
</code></pre></div><p>As expected, <code>Worker Phase</code> is <code>PartialReady</code> and <code>Ready Workers: 1</code> is less than <code>Desired Workers: 2</code>.</p> <p><strong>Check the workload to be created</strong></p> <p>A sample workload is provided to demonstrate how cache co-locality scheduling works. Let's check it out first:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ cat<span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>app.yaml</span>
apiVersion: apps/v1beta1
kind: StatefulSet
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  replicas: 2
  serviceName: &quot;nginx&quot;
  podManagementPolicy: &quot;Parallel&quot;
  selector: # define how the deployment finds the pods it manages
    matchLabels:
      app: nginx
  template: # define the pods specifications
    metadata:
      labels:
        app: nginx
    spec:
      affinity:
        # prevent two Nginx Pod from being scheduled at the same Node
        # just for demonstrating co-locality demo
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - nginx
            topologyKey: &quot;kubernetes.io/hostname&quot;
      containers:
        - name: nginx
          image: nginx
          volumeMounts:
            - mountPath: /data
              name: hbase-vol
      volumes:
        - name: hbase-vol
          persistentVolumeClaim:
            claimName: hbase
EOF</span>
</code></pre></div><p>The <code>podAntiAffinity</code> property might be a little confusing.
Here is the explanation: The <code>podAntiAffinity</code> property makes sure all pods created by the workload should be distributed across different nodes, which can provide us a clear view of how cache co-locality scheduling works.
In short, it's just a property for demonstration, you don't need to put much focus on that 😃</p> <p><strong>Run the workload</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl create -f app.yaml
statefulset.apps/nginx created
</code></pre></div><p><strong>Check status of the workload</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pod -o wide -l <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
NAME      READY   STATUS    RESTARTS   AGE    IP              NODE                       NOMINATED NODE   READINESS GATES
nginx-0   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m5s   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx-1   <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          2m5s   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>Only one Pod is ready, and running on the only node that matches the <code>nodeSelectorTerm</code></p> <p><strong>Check the reason why it's still not ready</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl describe pod nginx-1
<span class="token punctuation">..</span>.
Events:
  Type     Reason            Age        From               Message
  ----     ------            ----       ----               -------
  Warning  FailedScheduling  <span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span>  default-scheduler  <span class="token number">0</span>/2 nodes are available: <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> didn<span class="token string">'t match pod affinity/anti-affinity, 1 node(s) didn'</span>t satisfy existing pods anti-affinity rules, <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> had volume node affinity conflict.
  Warning  FailedScheduling  <span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span>  default-scheduler  <span class="token number">0</span>/2 nodes are available: <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> didn<span class="token string">'t match pod affinity/anti-affinity, 1 node(s) didn'</span>t satisfy existing pods anti-affinity rules, <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> had volume node affinity conflict.
</code></pre></div><p>As you may have seen, for one reason, <code>podAntiAffinity</code> prevents <code>nginx-1</code> Pod from being scheduled together with <code>nginx-0</code>. For another, there's only one node satisfying the given affinity condition.</p> <p><strong>Label another node</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl label node cn-beijing.192.168.1.147 hbase-cache<span class="token operator">=</span>true
</code></pre></div><p>Now all of the two nodes hold the same label <code>hbase-cache=true</code>, re-check all the pods:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pod -o wide
NAME                 READY   STATUS    RESTARTS   AGE   IP              NODE                       NOMINATED NODE   READINESS GATES
hbase-fuse-42csf     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          44m   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-fuse-kth4g     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10m   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-master-0       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          46m   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-worker-l62m4   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          44m   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-worker-rvncl   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          10m   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>There're two running Alluxio workers now.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get alluxioruntime hbase -o wide
NAME    READY MASTERS   DESIRED MASTERS   MASTER PHASE   READY WORKERS   DESIRED WORKERS   WORKER PHASE   READY FUSES   DESIRED FUSES   FUSE PHASE   AGE
hbase   <span class="token number">1</span>               <span class="token number">1</span>                 Ready          <span class="token number">2</span>               <span class="token number">2</span>                 Ready          <span class="token number">2</span>             <span class="token number">2</span>               Ready        46m43s
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pod -l <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx -o wide
NAME      READY   STATUS    RESTARTS   AGE   IP              NODE                       NOMINATED NODE   READINESS GATES
nginx-0   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          21m   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx-1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          21m   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>Another nginx Pod is also no longer pending.</p> <p>In conclusion, schedulable data cache and cache co-locality scheduling for workloads are both supported by Fluid. Usually, they work together and offer a more flexible way to users who need some data management in Kubernetes.</p> <h2 id="clean-up"><a href="#clean-up" class="header-anchor">#</a> Clean Up</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl delete -f <span class="token builtin class-name">.</span>

<span class="token comment"># unlabel nodes</span>
$ kubectl label node cn-beijing.192.168.1.146 hbase-cache-
$ kubectl label node cn-beijing.192.168.1.147 hbase-cache-
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepresswebsite/samples/accelerate_s3_minio.html" class="prev">
        DEMO - Speed Up Accessing Minio Files
      </a></span> <span class="next"><a href="/vuepresswebsite/samples/multi_dataset_same_node_accessing.html">
        DEMO - Single-Machine Multiple-Dataset Speed Up Accessing Remote Files
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepresswebsite/assets/js/app.62980e8d.js" defer></script><script src="/vuepresswebsite/assets/js/2.9a6ad13a.js" defer></script><script src="/vuepresswebsite/assets/js/38.55aca518.js" defer></script>
  </body>
</html>
